{"ast":null,"code":"var _jsxFileName = \"/app/src/Canteen1.js\",\n  _s = $RefreshSig$();\nimport { useEffect, useRef } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Canteen1 = () => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const wsRef = useRef(null);\n  const mediaStreamRef = useRef(null);\n  const isCameraStartedRef = useRef(false);\n  const reconnectTimeoutRef = useRef(null);\n  useEffect(() => {\n    const initWebSocket = () => {\n      const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:5000';\n      const wsProtocol = apiUrl.startsWith('https') ? 'wss:' : 'ws:';\n      const host = apiUrl.replace(/^https?:\\/\\//, '');\n      const wsUrl = `${wsProtocol}//${host}/ws/canteen/1`;\n      console.log('Connecting to WebSocket:', wsUrl);\n      wsRef.current = new WebSocket(wsUrl);\n      wsRef.current.onopen = () => {\n        console.log('WebSocket connected');\n        if (reconnectTimeoutRef.current) clearTimeout(reconnectTimeoutRef.current);\n      };\n      wsRef.current.onclose = () => {\n        console.log('WebSocket closed. Reconnecting...');\n        reconnectTimeoutRef.current = setTimeout(initWebSocket, 3000);\n      };\n      wsRef.current.onerror = err => {\n        console.error('WebSocket error:', err);\n        wsRef.current.close();\n      };\n    };\n    const startCamera = async () => {\n      if (isCameraStartedRef.current) return;\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: {\n            width: 640,\n            height: 480,\n            facingMode: 'environment'\n          },\n          audio: false\n        });\n        mediaStreamRef.current = stream;\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          try {\n            await videoRef.current.play();\n            isCameraStartedRef.current = true;\n          } catch (err) {\n            console.error('Video play failed:', err);\n          }\n        }\n      } catch (err) {\n        console.error('Camera access failed:', err);\n      }\n    };\n    initWebSocket();\n    startCamera();\n    const captureInterval = setInterval(() => {\n      var _wsRef$current;\n      if (videoRef.current && canvasRef.current && ((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) === WebSocket.OPEN) {\n        const canvas = canvasRef.current;\n        canvas.width = 640;\n        canvas.height = 480;\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\n        canvas.toBlob(blob => {\n          var _wsRef$current2;\n          if (blob && ((_wsRef$current2 = wsRef.current) === null || _wsRef$current2 === void 0 ? void 0 : _wsRef$current2.readyState) === WebSocket.OPEN) {\n            wsRef.current.send(blob);\n          }\n        }, 'image/jpeg', 0.8);\n      }\n    }, 1500);\n    return () => {\n      clearInterval(captureInterval);\n      if (mediaStreamRef.current) {\n        mediaStreamRef.current.getTracks().forEach(track => track.stop());\n      }\n      if (wsRef.current) wsRef.current.close();\n      if (reconnectTimeoutRef.current) clearTimeout(reconnectTimeoutRef.current);\n      isCameraStartedRef.current = false;\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Canteen Seat 1 Monitoring\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      autoPlay: true,\n      playsInline: true,\n      muted: true,\n      style: {\n        width: '640px',\n        height: '480px',\n        border: '1px solid #ccc'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'none'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n};\n_s(Canteen1, \"JhaMtTLw9R7aHhlgbZLZ1yTFSlA=\");\n_c = Canteen1;\nexport default Canteen1;\nvar _c;\n$RefreshReg$(_c, \"Canteen1\");","map":{"version":3,"names":["useEffect","useRef","jsxDEV","_jsxDEV","Canteen1","_s","videoRef","canvasRef","wsRef","mediaStreamRef","isCameraStartedRef","reconnectTimeoutRef","initWebSocket","apiUrl","process","env","REACT_APP_API_URL","wsProtocol","startsWith","host","replace","wsUrl","console","log","current","WebSocket","onopen","clearTimeout","onclose","setTimeout","onerror","err","error","close","startCamera","stream","navigator","mediaDevices","getUserMedia","video","width","height","facingMode","audio","srcObject","play","captureInterval","setInterval","_wsRef$current","readyState","OPEN","canvas","ctx","getContext","drawImage","toBlob","blob","_wsRef$current2","send","clearInterval","getTracks","forEach","track","stop","style","textAlign","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline","muted","border","display","_c","$RefreshReg$"],"sources":["/app/src/Canteen1.js"],"sourcesContent":["import { useEffect, useRef } from 'react';\r\n\r\nconst Canteen1 = () => {\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const wsRef = useRef(null);\r\n  const mediaStreamRef = useRef(null);\r\n  const isCameraStartedRef = useRef(false);\r\n  const reconnectTimeoutRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const initWebSocket = () => {\r\n      const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:5000';\r\n      const wsProtocol = apiUrl.startsWith('https') ? 'wss:' : 'ws:';\r\n      const host = apiUrl.replace(/^https?:\\/\\//, '');\r\n      const wsUrl = `${wsProtocol}//${host}/ws/canteen/1`;\r\n\r\n      console.log('Connecting to WebSocket:', wsUrl);\r\n\r\n      wsRef.current = new WebSocket(wsUrl);\r\n\r\n      wsRef.current.onopen = () => {\r\n        console.log('WebSocket connected');\r\n        if (reconnectTimeoutRef.current) clearTimeout(reconnectTimeoutRef.current);\r\n      };\r\n\r\n      wsRef.current.onclose = () => {\r\n        console.log('WebSocket closed. Reconnecting...');\r\n        reconnectTimeoutRef.current = setTimeout(initWebSocket, 3000);\r\n      };\r\n\r\n      wsRef.current.onerror = (err) => {\r\n        console.error('WebSocket error:', err);\r\n        wsRef.current.close();\r\n      };\r\n    };\r\n\r\n    const startCamera = async () => {\r\n      if (isCameraStartedRef.current) return;\r\n      try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n          video: { width: 640, height: 480, facingMode: 'environment' },\r\n          audio: false\r\n        });\r\n        mediaStreamRef.current = stream;\r\n        if (videoRef.current) {\r\n          videoRef.current.srcObject = stream;\r\n          try {\r\n            await videoRef.current.play();\r\n            isCameraStartedRef.current = true;\r\n          } catch (err) {\r\n            console.error('Video play failed:', err);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('Camera access failed:', err);\r\n      }\r\n    };\r\n\r\n    initWebSocket();\r\n    startCamera();\r\n\r\n    const captureInterval = setInterval(() => {\r\n      if (videoRef.current && canvasRef.current && wsRef.current?.readyState === WebSocket.OPEN) {\r\n        const canvas = canvasRef.current;\r\n        canvas.width = 640;\r\n        canvas.height = 480;\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\r\n        canvas.toBlob((blob) => {\r\n          if (blob && wsRef.current?.readyState === WebSocket.OPEN) {\r\n            wsRef.current.send(blob);\r\n          }\r\n        }, 'image/jpeg', 0.8);\r\n      }\r\n    }, 1500);\r\n\r\n    return () => {\r\n      clearInterval(captureInterval);\r\n      if (mediaStreamRef.current) {\r\n        mediaStreamRef.current.getTracks().forEach(track => track.stop());\r\n      }\r\n      if (wsRef.current) wsRef.current.close();\r\n      if (reconnectTimeoutRef.current) clearTimeout(reconnectTimeoutRef.current);\r\n      isCameraStartedRef.current = false;\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{ textAlign: 'center' }}>\r\n      <h2>Canteen Seat 1 Monitoring</h2>\r\n      <video\r\n        ref={videoRef}\r\n        autoPlay\r\n        playsInline\r\n        muted\r\n        style={{ width: '640px', height: '480px', border: '1px solid #ccc' }}\r\n      />\r\n      <canvas ref={canvasRef} style={{ display: 'none' }} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Canteen1;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}